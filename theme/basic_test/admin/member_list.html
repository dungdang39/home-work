{% extends "/admin/_layout.html" %}
{% from "macro.html" import checked, renderPagination, selected %}

{% set title = "회원 > 회원관리" %}
{% block title %}{{ title }}{% endblock title %}

{% block content %}
<h1 id="container_title">{{ title }}</h1>
<div class="container_wr">
    <div class="local_ov01 local_ov">
        <span class="btn_ov01">
            <span class="ov_txt">총 회원수 </span>
            <span class="ov_num"> {{ total_count|format_number }}명 </span>
        </span>
        <a href="{{ url_for('admin.member.manage') }}" class="ov_listall">전체목록</a>
        <a href="{{ url_for('admin.member.manage') }}?status=normal" class="ov_listall">일반</a>
        <a href="{{ url_for('admin.member.manage') }}?status=intercept" class="ov_listall">차단</a>
        <a href="{{ url_for('admin.member.manage') }}?status=leave" class="ov_listall">탈퇴</a>
    </div>

    <form id="form_search" name="form_search" class="local_sch01 local_sch" method="get">
        <input type="hidden" name="status" value="{{ search.status }}">
        <label for="field" class="sound_only">검색대상</label>
        <select name="field" id="field">
            <option value="mb_id" {{ selected('mb_id', search.field) }}>회원아이디</option>
            <option value="mb_nick" {{ selected('mb_nick', search.field) }}>닉네임</option>
            <option value="mb_name" {{ selected('mb_name', search.field) }}>이름</option>
            <option value="mb_level" {{ selected('mb_level', search.field) }}>권한</option>
            <option value="mb_email" {{ selected('mb_email', search.field) }}>E-MAIL</option>
            <option value="mb_tel" {{ selected('mb_tel', search.field) }}>전화번호</option>
            <option value="mb_hp" {{ selected('mb_hp', search.field) }}>휴대폰번호</option>
            <option value="mb_point" {{ selected('mb_point', search.field) }}>포인트</option>
            <option value="mb_datetime" {{ selected('mb_datetime', search.field) }}>가입일시</option>
            <option value="mb_ip" {{ selected('mb_ip', search.field) }}>IP</option>
            <option value="mb_recommend" {{ selected('mb_recommend', search.field) }}>추천인</option>
        </select>
        <label for="keyword" class="sound_only">검색어<strong class="sound_only"> 필수</strong></label>
        <input type="text" id="keyword" name="keyword" class="required frm_input" value="{{ search.keyword }}" required>
        <input type="submit" class="btn_submit" value="검색">
    </form>

    <div class="local_desc01 local_desc">
        <p>
            회원자료 삭제 시 다른 회원이 기존 회원아이디를 사용하지 못하도록 회원아이디, 이름, 닉네임은 삭제하지 않고 영구 보관합니다.
        </p>
    </div>

    <form name="form_member_list" id="form_member_list" action="{{ url_for('admin.member.manage.delete.list') }}"
        onsubmit="return validate_form(this);" method="post">
        <input type="hidden" name="sst" value="mb_datetime">
        <input type="hidden" name="sod" value="desc">
        <input type="hidden" name="sfl" value="">
        <input type="hidden" name="stx" value="">
        <input type="hidden" name="page" value="2">
        <input type="hidden" name="token" value="">

        <div class="tbl_head01 tbl_wrap">
            <table>
                <caption>회원관리 목록</caption>
                <thead>
                    <tr>
                        <th scope="col" id="mb_list_chk" rowspan="2">
                            <label for="chkall" class="sound_only">회원 전체</label>
                            <input type="checkbox" name="chkall" value="1" id="chkall" onclick="check_all(this.form)">
                        </th>
                        <th scope="col" id="mb_list_id">아이디</th>
                        <th scope="col" id="mb_list_name">이름</th>
                        <th scope="col" id="mb_list_nick">닉네임</th>
                        <th scope="col" id="mb_list_deny">레벨</th>
                        <th scope="col" id="mb_list_grp">그룹</th>
                        <th scope="col" id="mb_list_auth">상태</th>
                        <th scope="col" id="mb_list_blank"></th>
                        <th scope="col" id="mb_list_memo">메모</th>
                        <th scope="col" id="mb_list_mng">관리</th>
                    </tr>
                </thead>
                <tbody>
                    {% for member in members %}
                    <tr class="bg{{ cycle(['0', '1'], loop.index0) }}">
                        <td headers="mb_list_chk" class="td_chk">
                            <input type="hidden" name="mb_id[{{ loop.index0 }}]" value="admin">
                            <label for="chk_{{ loop.index0 }}" class="sound_only">{{ member.mb_name }}</label>
                            <input type="checkbox" id="chk_{{ loop.index0 }}" name="chk[]" value="{{ loop.index0 }}">
                        </td>
                        <td headers="mb_list_id" class="td_name sv_use">
                            {{- member.mb_id -}}
                        </td>
                        <td headers="mb_list_name" class="td_mbname">
                            {{- member.mb_name -}}
                        </td>
                        <td headers="mb_list_nick" class="td_name sv_use">
                            <div>
                                <span class="sv_wrap">
                                    <a href="http://127.0.0.1/g5-update/bbs/profile.php?mb_id=admin"
                                        class="sv_member" title="{{ member.mb_nick }} 자기소개" target="_blank" rel="nofollow"
                                        onclick="return false;">
                                        <span class="profile_img">
                                            <img src="http://127.0.0.1/g5-update/data/member/ad/admin.gif?1722411276" width="22" height="22" alt="">
                                        </span>
                                        {{ member.mb_nick }}
                                    </a>
                                </span>
                            </div>
                        </td>
                        <td headers="mb_list_deny" class="td_mng_m">
                            <select id="mb_level[{{ loop.index0 }}]" name="mb_level[{{ loop.index0 }}]">
                            {% for level in range(1, 10) %}
                                <option value="{{ level }}" {{ selected(level, member.mb_level) }}>{{ level }}</option>
                            {% endfor %}
                            </select>
                        </td>
                        <td headers="mb_list_grp" class="td_mng_m">
                            <select name="group">
                                <option value="">선택</option>
                                <option value="1">그룹1</option>
                                <option value="2">그룹2</option>
                                <option value="3">그룹3</option>
                            </select>
                        </td>
                        <td headers="mb_list_auth" class="td_mng_m">
                            <select name="group">
                                <option value="">선택</option>
                                <option value="normal" {{ selected('normal', member.status ) }}>일반</option>
                                <option value="intercept" {{ selected('intercept', member.status ) }}>차단</option>
                                <option value="leave" {{ selected('leave', member.status ) }}>탈퇴</option>
                            </select>
                        </td>
                        <td headers="mb_list_blank" class="td_mng_m"></td>
                        <td headers="mb_list_memo" class="td_mng_m"></td>

                        <td headers="mb_list_mng" class="td_mng td_mng_m">
                            <a href="{{ url_for('admin.member.manage.view', {mb_id: member.mb_id}) }}" class="btn btn_03">관리</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <div class="btn_fixed_top">
            <input type="submit" name="act_button" value="선택수정" onclick="document.pressed=this.value"
                class="btn btn_02">
            <input type="submit" name="act_button" value="선택삭제" onclick="document.pressed=this.value"
                class="btn btn_02">
            <a href="{{ url_for('admin.member.manage.create') }}" id="member_add" class="btn btn_01">회원추가</a>
        </div>
    </form>

    {{ renderPagination(pagination, query_params) }}

</div>
<script>
    function validate_form(f) {
        if (!is_checked("chk[]")) {
            alert(document.pressed + " 하실 항목을 하나 이상 선택하세요.");
            return false;
        }

        if (document.pressed == "선택삭제") {
            if (!confirm("선택한 자료를 정말 삭제하시겠습니까?")) {
                return false;
            }
        }

        return true;
    }
</script>
{% endblock content %}